# 后台管理相关接口 TODO 清单

> 本文档用于记录后台管理模块预计对接的接口信息，便于后续与后端对齐实现方案。所有接口返回格式统一为 `{ code, msg, data }`。

## 一、菜单与路由

- 接口名称：获取后台菜单树  
- 接口地址：`GET /api/admin/menu/tree`  
- 请求参数：无  
- 返回数据示例：
  ```json
  {
    "code": 0,
    "msg": "ok",
    "data": [
      {
        "id": "dashboard",
        "name": "仪表盘总览",
        "path": "/admin",
        "icon": "FiPieChart",
        "permission": "dashboard:view",
        "children": []
      }
    ]
  }
  ```  
- 测试用例要点：
  - 返回至少包含「仪表盘总览」菜单
  - 未登录或无权限时返回 401/403，并携带明确错误信息  
- 精简待办：
  - 确认图标枚举的最终命名规范  
  - 与权限模型对齐 `permission` 字段取值

## 二、仪表盘数据总览

- 接口名称：获取仪表盘核心指标  
- 接口地址：`GET /api/admin/dashboard/overview`  
- 请求参数：
  - `range`: string，时间范围，如 `7d`、`30d`  
- 返回数据示例：
  ```json
  {
    "code": 0,
    "msg": "ok",
    "data": {
      "docTotal": 128,
      "docIncrease": 12,
      "videoTotal": 36,
      "videoIncrease": 3,
      "activeUsers": 842,
      "activeRate": 0.18,
      "pageViews": 12400,
      "pvChangeRate": 0.09
    }
  }
  ```  
- 测试用例要点：
  - range 为空时默认返回最近 7 天数据  
  - 数值字段均为非负数，且类型为 number  
- 精简待办：
  - 明确活跃用户统计口径（登录行为 / 访问行为）  
  - 确认是否需要支持多维度过滤（按频道、标签等）

## 三、内容访问结构（文档 / 视频）

- 接口名称：获取访问结构柱状图数据  
- 接口地址：`GET /api/admin/dashboard/traffic`  
- 请求参数：
  - `range`: string，时间范围，如 `7d`  
- 返回数据示例：
  ```json
  {
    "code": 0,
    "msg": "ok",
    "data": [
      { "type": "document", "date": "周一", "value": 320 },
      { "type": "video", "date": "周一", "value": 210 }
    ]
  }
  ```  
- 测试用例要点：
  - `type` 仅允许 `document`、`video` 两种取值  
  - 同一天内最多两条记录（对应文档 / 视频）  
- 精简待办：
  - 约定日期字段具体格式（`周一` / `2026-01-01`）  
  - 确认是否需要补充更多内容类型（工具、用户主页等）

## 四、整体访问趋势

- 接口名称：获取整体访问折线图数据  
- 接口地址：`GET /api/admin/dashboard/trend`  
- 请求参数：
  - `range`: string，时间范围，如 `7d`、`30d`  
- 返回数据示例：
  ```json
  {
    "code": 0,
    "msg": "ok",
    "data": [
      { "date": "2026-01-01", "value": 420 },
      { "date": "2026-01-02", "value": 460 }
    ]
  }
  ```  
- 测试用例要点：
  - 日期连续且不重复  
  - value 为访问总量（PV），与其他统计接口一致  
- 精简待办：
  - 是否需要兼容 UV、独立访客等更多维度  
  - 是否按时段（小时级别）返回数据

## 五、最近操作记录

- 接口名称：获取后台最近操作日志  
- 接口地址：`GET /api/admin/logs/recent`  
- 请求参数：
  - `category`: string，可选，`content` | `user` | `system`  
  - `page`: number，页码，从 1 开始  
  - `pageSize`: number，分页大小，默认 10  
- 返回数据示例：
  ```json
  {
    "code": 0,
    "msg": "ok",
    "data": {
      "list": [
        {
          "id": "log_1",
          "category": "content",
          "operator": "admin",
          "action": "publish_doc",
          "detail": "上架新文档《如何把视频课程拆解成学习笔记》",
          "createdAt": "2026-01-10 11:23:00"
        }
      ],
      "total": 32
    }
  }
  ```  
- 测试用例要点：
  - category 缺省时返回所有类型  
  - 分页返回 total，总数应大于等于当前页记录数  
- 精简待办：
  - 与审核模块的操作日志字段保持一致  
  - 确认操作类型枚举及多语言描述方案

## 附录：接口测试用例模板与后端对接 Checklist（后台管理模块）

> 本附录面向后台菜单、仪表盘总览、操作日志等通用管理接口，提供统一的接口记录与测试模板，便于不同子模块复用。

### A. 单接口记录与测试要点模板

1. 基础信息
   - 接口名称：  
   - 接口地址：`[METHOD] /api/admin/...`  
   - HTTP 方法：GET / POST / PUT / DELETE  
   - 所属模块：后台管理 / 菜单 / 仪表盘 / 操作日志 等  
   - 前端入口：页面名称 + 功能按钮说明  
   - 是否需要登录：是 / 否  
   - 所需权限点：如 `menu:view`、`dashboard:view`、`log:view` 等  

2. 请求参数设计
   - 参数位置：Query / Body(JSON) / Path / Header  
   - 参数列表（建议使用表格补充）：

     | 字段名   | 类型   | 必填 | 示例值   | 说明                 |
     | -------- | ------ | ---- | -------- | -------------------- |
     | range    | string | 否   | 7d       | 时间范围             |
     | page     | number | 否   | 1        | 页码，从 1 开始      |
     | pageSize | number | 否   | 20       | 每页数量             |
     | category | string | 否   | content  | 日志 / 菜单分类等    |
     | ...      | ...    | ...  | ...      | ...                  |

3. 响应数据结构
   - 标准响应：`{ code, msg, data }`  
   - 若为列表接口，`data` 通常包含：

     | 字段名          | 类型     | 示例值 | 说明     |
     | --------------- | -------- | ------ | -------- |
     | list            | object[] |        | 列表数据 |
     | total           | number   | 32     | 总条数   |
     | list[].id       | string   | log_1  | 主键 ID  |
     | list[].createdAt| string   | ...    | 创建时间 |

4. 错误码与异常场景
   - 未登录 / 无权限：401 / 403  
   - 参数错误：如 range 非法、page/pageSize 越界等  
   - 数据不存在：例如查询不存在的日志 / 菜单 ID  
   - 每个错误场景至少列出 1 条测试用例。  

5. 业务规则与边界条件
   - 默认时间范围 / 默认分页大小  
   - 是否允许返回空列表（推荐返回空数组而不是错误）  
   - 数据展示排序规则（按时间倒序 / 权重等）。  

6. 权限与安全要求
   - 接口对应的权限点（如仅管理员可访问操作日志导出等）  
   - 是否包含敏感信息（如 IP、操作详情、内部标签等），需在返回中做脱敏处理。  

7. 性能与限流要求
   - 日志 / 菜单等接口是否需要限制最大分页大小  
   - 高频访问的仪表盘接口是否有缓存策略。  

8. 日志与监控
   - 对哪些接口访问需要记录到行为审计 / 系统日志中  
   - 是否需要为关键接口添加独立监控指标（例如仪表盘 overview 延迟）。  

9. 兼容性与变更记录
   - 字段新增、删除或类型变更时如何通知前端  
   - 是否需要在 TODO 文档中记录变更时间与影响范围。  

### B. 接口测试用例条目模板

- 用例编号：ADMIN-API-001  
- 用例名称：获取菜单树成功  
- 前置条件：
  - 已登录后台，账号具备 `menu:view` 权限  
- 步骤：
  1. 调用 `GET /api/admin/menu/tree`，不传任何参数  
- 预期结果：
  - 返回 `code=0`，`data` 为非空数组  
  - 至少包含「仪表盘总览」菜单节点  
- 备注：可根据需要补充更多断言（如权限字段、icon 字段等）。  

可使用上述结构为每个接口补充多条用例，便于测试人员与开发人员共享。  

### C. 后端对接 Checklist（模块级）

1. 设计阶段
   - [ ] 已在本文件登记所有菜单、仪表盘、日志相关接口  
   - [ ] 与后端确认不同角色 / 权限下的可见数据范围  

2. 开发阶段
   - [ ] 后端已实现并在测试环境开放接口  
   - [ ] 前端已完成 `src/api/admin/dashboard.ts` 等封装，并在页面中调用  

3. 联调阶段
   - [ ] 针对列表类接口验证分页、排序、筛选条件  
   - [ ] 针对权限相关接口验证 401/403 等无权限场景  

4. 上线前
   - [ ] 确认仪表盘数据、操作日志信息无敏感泄露风险  
   - [ ] 已根据联调情况更新测试要点与精简待办条目  

5. 上线后
   - [ ] 观察仪表盘访问性能与错误率  
   - [ ] 根据实际运维反馈迭代本文件记录。  
