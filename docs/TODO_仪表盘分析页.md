# 仪表盘 · 分析页数字大屏接口 TODO 清单

> 本文档用于记录「仪表盘分析页 · 数字大屏」预计对接的接口信息，便于后续与后端对齐实现方案。所有接口返回格式统一为 `{ code, msg, data }`。

## 一、数字大屏关键指标

- 接口名称：获取数字大屏核心指标概览  
- 接口地址：`GET /api/admin/dashboard/analysis/metrics`  
- 请求参数：
  - `range`: string，时间范围，如 `today`、`7d`、`30d`，默认 `today`  
- 返回数据示例：
  ```json
  {
    "code": 0,
    "msg": "ok",
    "data": {
      "pvToday": 3200,
      "pvTodayChange": 0.12,
      "pv7d": 21400,
      "pv7dChange": 0.18,
      "contentTotal": 164,
      "contentIncrease": 15,
      "systemHealthScore": 96,
      "systemHealthText": "稳定"
    }
  }
  ```  
- 测试用例要点：
  - range 为空时默认返回今日数据  
  - `pvTodayChange`、`pv7dChange` 为浮点数，范围为 `[-1, +∞)`  
  - `systemHealthScore` 范围为 `[0, 100]`，并与 `systemHealthText` 文案含义一致  
- 精简待办：
  - 与整体仪表盘 overview 接口字段命名保持一致  
  - 明确系统健康度计算口径（失败率、告警次数、接口耗时等权重）  

## 二、数字大屏时间段访问分布

- 接口名称：获取数字大屏时间维度访问分布  
- 接口地址：`GET /api/admin/dashboard/analysis/time-distribution`  
- 请求参数：
  - `date`: string，日期，如 `2026-01-18`，默认当天  
  - `step`: string，时间粒度，可选 `hour` | `half-hour`，默认 `hour`  
- 返回数据示例：
  ```json
  {
    "code": 0,
    "msg": "ok",
    "data": [
      { "type": "document", "time": "10:00", "value": 520 },
      { "type": "video", "time": "10:00", "value": 320 },
      { "type": "document", "time": "12:00", "value": 680 },
      { "type": "video", "time": "12:00", "value": 410 }
    ]
  }
  ```  
- 测试用例要点：
  - `type` 仅允许 `document`、`video` 两种取值  
  - 同一时间点最多两条记录（对应文档、视频），不得出现重复类型  
  - `time` 字段需要与 `step` 粒度匹配，按时间升序返回  
- 精简待办：
  - 确认是否需要扩展更多内容类型（工具、用户主页等）  
  - 讨论是否需要支持多日期对比模式（例如今日对比昨日同一时间段）  

## 三、数字大屏展示模式配置

- 接口名称：获取数字大屏展示配置  
- 接口地址：`GET /api/admin/dashboard/analysis/display-config`  
- 请求参数：无  
- 返回数据示例：
  ```json
  {
    "code": 0,
    "msg": "ok",
    "data": {
      "defaultTheme": "auto",
      "allowedThemes": ["light", "dark", "auto"],
      "autoThemeFollowSystem": true,
      "fullScreenHideElements": ["header", "tabs", "footer"]
    }
  }
  ```  
- 测试用例要点：
  - `defaultTheme` 必须包含在 `allowedThemes` 中  
  - `fullScreenHideElements` 与前端实际可隐藏元素枚举保持一致  
- 精简待办：
  - 与全局主题系统对齐「auto」模式含义（跟随系统还是跟随站点设置）  
  - 确认是否需要支持多套布局模板配置（例如一行两图、单图全宽等）  

## 四、接口安全与性能要求（建议）

- 所有接口仅对具备后台访问权限的账号开放，需要携带有效鉴权信息  
- 数字大屏场景下建议配合缓存（如每分钟刷新一次），避免实时高频查询对数据库造成压力  
- 建议返回时间范围内的总访问量、峰值时间点等聚合信息，减少前端二次统计逻辑  

## 附录：接口测试用例模板与后端对接 Checklist（仪表盘分析页）

> 本附录主要用于「仪表盘分析页 · 数字大屏」相关接口，包括指标、时间分布、展示配置等，帮助前后端在设计与联调过程中统一标准。

### A. 单接口记录与测试要点模板

1. 基础信息
   - 接口名称：  
   - 接口地址：`[METHOD] /api/admin/dashboard/analysis/...`  
   - HTTP 方法：GET / POST  
   - 所属模块：仪表盘分析页  
   - 前端入口：对应大屏组件（如顶部数字卡片、折线图、热力图等）  
   - 是否需要登录：是  
   - 所需权限点：如 `dashboard:analysis:view` 等  

2. 请求参数设计
   - 核心参数：`range`、`date`、`step`、维度筛选字段等  
   - 参数表（建议使用表格）：

     | 字段名 | 类型   | 必填 | 示例值      | 说明                         |
     | ------ | ------ | ---- | ----------- | ---------------------------- |
     | range  | string | 否   | 7d          | 时间范围                     |
     | date   | string | 否   | 2026-01-18  | 具体日期（用于时间分布接口） |
     | step   | string | 否   | hour        | 时间粒度                     |
     | ...    | ...    | ...  | ...         | ...                          |

3. 响应数据结构
   - `data` 中通常包含统计值、趋势数组或配置对象：  

     | 字段名         | 类型     | 示例值 | 说明                     |
     | -------------- | -------- | ------ | ------------------------ |
     | pvToday        | number   | 3200   | 今日访问量               |
     | pvTodayChange  | number   | 0.12   | 今日访问量环比变化       |
     | list/timeSeries| object[] |        | 时间分布数据             |
     | defaultTheme   | string   | auto   | 默认主题配置             |

4. 错误码与异常场景
   - 时间范围非法（如起止时间颠倒 / 跨度过大）  
   - 粒度 step 与时间范围不匹配  
   - 缺少必填参数（如必须指定 date 时未传）  

5. 业务规则与边界条件
   - 默认时间范围与默认粒度设置  
   - 对零数据 / 空数据场景的约定（如返回空数组而非错误）  
   - 指标取值范围约束（如健康分数 [0,100]）。  

6. 性能与缓存策略
   - 是否启用缓存（如按分钟维度）  
   - 建议的最大查询范围（避免一次性加载过多历史数据）。  

7. 可视化展示约束
   - 日期顺序、时间轴顺序要求  
   - 多类型（document/video）数据对齐方式。  

### B. 接口测试用例条目模板

- 用例编号：ANALYSIS-API-001  
- 用例名称：获取 7 天访问指标成功  
- 前置条件：已登录后台，具备查看分析大屏权限  
- 步骤：
  1. 调用 `GET /api/admin/dashboard/analysis/metrics?range=7d`  
- 预期结果：
  - 返回 `code=0`，`data.pv7d`、`data.pv7dChange` 等字段存在且类型正确  
  - 访问范围与其他仪表盘接口数据一致。  

再基于此模板覆盖「range 为空」「range 非法」「无权限」「时间范围过大」等场景。  

### C. 后端对接 Checklist（模块级）

1. 设计阶段
   - [ ] 已为所有分析页接口（指标、时间分布、展示配置等）补充记录  
   - [ ] 明确每个指标的统计口径和计算方式，并在文档中说明  

2. 开发阶段
   - [ ] 后端已在测试环境提供接口，并进行基础性能测试  
   - [ ] 前端图表组件已按约定字段开发完成  

3. 联调阶段
   - [ ] 对比多日数据，验证趋势与实际访问日志大致一致  
   - [ ] 验证缓存策略是否生效（例如连续请求不会频繁命中数据库）。  

4. 上线前
   - [ ] 为关键接口配置告警阈值（如响应时间、错误率）  

5. 上线后
   - [ ] 持续观察大屏数据异常情况，并在本文件记录发现的问题与处理结果。  
